## PUT 500 на 10 секунд

Решил начать с малого, чтобы просто опробовать работу с wrk. Начал с вставки данных.

### Перцентили:
```
 50.000%    2.50ms
 75.000%    5.01ms
 90.000%   11.49ms
 99.000%   73.47ms
 99.900%  157.70ms
 99.990%  166.78ms
 99.999%  166.78ms
100.000%  166.78ms
```

Можно отметить уже приличное время на 90-ом и 99-ом перцентиле. 
Одно из предположений: работа проводилась на виртуалке.

## PUT 3000 на 30 секунд

Далее решил попробовать увеличить количество запросов до 3000, а время до 30 секунд.

### Перцентили:
```
 50.000%    6.73ms
 75.000%   20.35ms
 90.000%   37.31ms
 99.000%  517.12ms
 99.900%  647.17ms
 99.990%  659.46ms
 99.999%  659.97ms
100.000%  659.97ms
```

Отметим значительное увеличение времени. Однако, даже при таких данных почти 100% удается обработать.
Еще стоит отметить, что при прогретом сервере время может упасть чуть ли не в 10 раз, но также оставаться высоким.

На 10000 также возрасло время, но почти 100% запросов были обработаны.

## PUT 25000 на 30 секунд

### Перцентили:
```
 50.000%    4.27s 
 75.000%    6.35s 
 90.000%    6.98s 
 99.000%    7.22s 
 99.900%    8.26s 
 99.990%    8.36s 
 99.999%    8.37s 
100.000%    8.37s 
```

На 25000 запросов как я понял, сервер уже не тянул и порядка 30% запросов не успели пройти.
Соответсвенно уже даже при 50-ом перцентиле время ответа достаточно немаленькое.

Далее на 3000 и 10000 запросов сделал графа для анализа нагрузки на CPU и просмотра аллокаций и будут ли какие-то изменения.

### Flame Graph (CPU)

Файлы: put_profile_3000_cpu.html и put_profile_10000_cpu.html

Как я понял, из графа 40% уходит на работу самой виртуалки, что также может являться причиной долгой работы 
обработки запросов из данных перцентилей выше.

Также из общей тенденции из всех процессов самым большим является обработка запроса.

### Flame Graph (ALLOC)

Файлы: put_profile_3000_alloc.html и put_profile_10000_alloc.html

## GET 500 на 10 секунд

Для запросов GET также решил начать с малого.

### Перцентили:
```
 50.000%    2.11ms
 75.000%    3.26ms
 90.000%    5.96ms
 99.000%   20.13ms
 99.900%   39.26ms
 99.990%   43.78ms
 99.999%   43.78ms
100.000%   43.78ms
```

Скачок наблюдается в 99-ом прецентиле. Но ничего необычного вроде нет.

## GET 3000 на 30 секунд

### Перцентили:
```
 50.000%   13.08ms
 75.000%   46.69ms
 90.000%   72.64ms
 99.000%  107.65ms
 99.900%  115.78ms
 99.990%  116.93ms
 99.999%  117.06ms
100.000%  117.12ms
```

## GET 25000 на 30 секунд

### Перцентили:
```
 50.000%    8.75s
 75.000%   10.54s
 90.000%   11.21s
 99.000%   11.63s
 99.900%   11.65s
 99.990%   11.65s
 99.999%   11.65s
100.000%   11.65s
```

В остальных случаях серверу хоть и немного плохо, но все запросы обрабатывать успевает. 
Понятно, что есть моменты, когда данных не находится.

### Flame Graph (CPU)

Файлы: get_profile_3000_cpu.html и get_profile_10000_cpu.html

Также как и при вставке данных, большая часть - обработка запроса.

### Flame Graph (ALLOC)

Файлы: get_profile_3000_alloc.html и get_profile_10000_alloc.html

Здесь основной момент аллокации происходит, когда для создания ответа нам необходимо из MemorySegment сделать массив байтов.

# Предложения по оптимизации
- Не работать на виртуалке
- Попробовать изменить настройки сервера
- Так как много ресурсов уходит на работу со строками, то получать id сразу в байтах